# Google Storage Infra L6 知識點補充清單

## 1. C++ / Embedded 基礎
- **Pointer vs Reference**
    - `T* p` → 指標，能換指向別的位址，可以做 pointer arithmetic
    - `T& r` → 參考，必須綁定一個變數，不能改綁定，常用於 API 傳參
- **volatile**
    - 告訴 compiler **不要最佳化這個變數**，因為值可能隨硬體改變（ex: MMIO register）
    - 不保證 atomic / ordering，需要 `std::atomic` 或 memory barrier 配合
- **Offset / Memory boundary**
    - 記憶體對齊 (alignment)：32-bit MCU → register 4-byte boundary
    - pointer + offset：`*(base + offset)` = 訪問 memory-mapped register

---

## 2. Concurrency / Multi-thread
- **mutex**
    - mutual exclusion，保護 critical section
    - 常用 RAII：`std::lock_guard<std::mutex> lock(mtx);`
- **semaphore**
    - 計數器，允許多個 thread 同時進入臨界區
- **condition_variable**
    - 配合 mutex，用來等待事件（ex: FIFO buffer 非空）
- **atomic**
    - lock-free 操作，保證單一變數的 thread-safe（但不是複合操作）
- **典型題**
    - LC 1114. Print in Order (Easy) → 基本 sync
    - LC 1115. Print FooBar Alternately (Medium) → thread 交替
    - Blocking Queue → 面試高頻

---

## 3. 計算機組織 / 架構
- **Memory Hierarchy**
    - Register (ns) → Cache (10ns) → DRAM (100ns) → SSD (100µs) → HDD (ms)
    - Storage infra 設計時要 aware latency gap
- **I/O block**
    - Block device（disk, SSD）以 block 為單位存取
    - Character device（UART, SPI）是 stream-based
- **Cache/Memory 限制**
    - Embedded / storage system 常有限制：buffer size, register bit width
    - 解法：LRU cache, FIFO buffer, ring buffer

---

## 4. Embedded System 必考
- **MCU (Microcontroller Unit)**
    - 單晶片，低功耗，整合 CPU + memory + peripherals
    - 與 CPU 差異：MCU 多用於控制（IoT, sensor），CPU 多用於計算
- **FIFO (First In First Out)**
    - 實作方式：ring buffer + head/tail pointer
    - 常見於 UART / DMA buffer
- **Timer / Tick**
    - Timer 可配置週期 → 產生中斷 (IRQ)
    - OS scheduler 用 tick (ex: 1ms tick) 做 thread preemption
- **IRQ (Interrupt Request)**
    - critical section 時要 disable IRQ，避免 register 被半更新狀態讀取
    - workflow: enable IRQ → handle event → disable IRQ → restore
- **Board Support Package (BSP)**
    - OS 與硬體的抽象層：初始化 CPU, timer, GPIO, UART, driver
    - Linux 在 MCU 上 boot 時，第一層就是 BSP

---

## 5. 系統設計（Storage / Infra）
- **Rate Limiter**
    - Leaky Bucket → 平滑流量
    - Token Bucket → 控制 burst + sustained rate
- **LRU Cache**
    - HashMap + Doubly Linked List
    - 對應 storage eviction / memory 限制
- **分散式 Storage**
    - **Metadata Server**：leader election, replication, failover
    - **Data Node**：sharding, replication factor
    - **CAP theorem**：
        - CP → 保證一致性，但可能犧牲可用性
        - AP → 保證可用性，但可能犧牲一致性
- **I/O path**
    - App → syscall → FS → block layer → driver → DMA → device

---

## 6. 面試常問「Critical Thinking」問題
- 何時要 **disable IRQ**？
    - ex: 正在更新 register，不能被中斷
- 如何計算 **timer tick**？
    - tick = (clock_freq / prescaler) × counter
- 如果有 **memory 限制（ex: 4KB buffer）**，怎麼設計演算法？
    - streaming algorithm（sliding window, moving average, heap-based）
- 遇到 **硬體設限**（register bit width, buffer overflow）怎麼辦？
    - bit masking, overflow check, 或 multi-register chaining

---

# ✅ 使用方式
- 白天：刷題（Coding + Concurrency + LRU/Heap）
- 晚上：看這份 **知識點清單**，練習「解釋給面試官聽」
- 最後一天：做 **mock interview**（Coding + 系統設計 + 行為題 各 1）
